<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:custom="http://myagile.com/custom">

	<c:set var="uploadExelFile" value="excelFile"/>	
	<p:fieldset id="fieldset-projectSelector" style="margin-bottom:10px" styleClass="span12">
		<h:form styleClass="form-inline" id="form-projectSelector">
			<h:outputLabel for="projectSelector" value="Select a Project:" style="margin-right:5px"/>
			<p:selectOneMenu id="projectNullSelector" rendered="#{empty productBacklogBean.projectList}" styleClass="text-left">
				<f:selectItem itemLabel="No project" noSelectionOption="true"/>
			</p:selectOneMenu>
			<p:selectOneMenu id="projectSelector" value="#{productBacklogBean.projectId}" onchange="hideUserStoryForm()" rendered="#{!empty productBacklogBean.projectList}" styleClass="text-left">
				<f:selectItems value="#{productBacklogBean.projectList}" var="p" itemValue="#{p.projectId}" itemLabel="#{p.projectName}" />
				<p:ajax event="change" listener="#{productBacklogBean.handleChangeProject}" update=":userStoryForm,:form-userStoryTable" oncomplete="userStoryTableVar.filter();"/>
			</p:selectOneMenu>		
			<h:panelGroup rendered="#{!empty productBacklogBean.projectList and !custom:isStackHolder(productBacklogBean.projectId)}">
				<p:commandButton id="addUserStoryBtn" value="New" icon="icon-plus" style="#{productBacklogBean.projectId eq 0 ?'display: none;' :''}; margin-left:5px;"
					actionListener="#{productBacklogBean.handleCreateNewUserStory}" global="false"
					onclick="showUserStoryForm()" update=":userStoryForm" >
					<f:setPropertyActionListener target="#{productBacklogBean.edit}" value="#{true}"/>
				</p:commandButton>
				<button type="button" id="uploadExcel" title="Choose the excel file to upload"
					class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-left btn-upload">
					<span class="icon-download-alt ui-button-icon-left ui-icon ui-c"></span>
					<span class="ui-button-text ui-c">Import Excel File</span>
				</button>
				<p:commandButton id="exportExcel"  value="Export Excel File" icon="icon-upload-alt" ajax="false"
					style="#{productBacklogBean.projectId eq 0 ?'display: none;' :''}; margin-left:5px;"
					actionListener="#{productBacklogBean.exportExcelProductBacklogFromProject}">
				</p:commandButton>
			</h:panelGroup>	
			<div id="uploadExcelMessages"
				style="display: none; top: 5px; position: relative; margin-top: 0px !important; padding-right: 0px !important; font-size: 12px !important;"
				class="ui-message-info ui-widget ui-corner-all">
				<a class="ui-messages-close" style="float: right"
					onclick="$(this).parent().slideUp();return false;"> <span
					class="ui-icon ui-icon-close"></span>
				</a> <span class="ui-message-info-icon"></span> <span
					class="ui-message-info-detail"></span>
			</div>
			<p:remoteCommand name="uploadExcelClient"
				oncomplete="handleResultExcelUpload(xhr, status, args);handleCreateComplete(xhr, status, args);userStoryTableVar.filter();"
				actionListener="#{productBacklogBean.handleUploadExcelFile(uploadExelFile)}"
				update=":userStoryForm, :form-userStoryTable">
			</p:remoteCommand>	
		</h:form>
		<script type="text/javascript">	
			$(document).ready(function () { 
				initUploadExcelFile("uploadExcel", "#{request.contextPath}/upload","#{uploadExelFile}","#{productBacklogBean.projectId}");
			});
		</script>  
	</p:fieldset>
</html>